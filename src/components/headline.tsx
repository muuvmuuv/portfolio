import { animate, stagger } from "animejs";
import { useEffect, useRef } from "preact/hooks";

interface HeadlineProps {
	className?: string;
}

export default function Headline({ className }: HeadlineProps) {
	const groupRef = useRef<SVGGElement>(null);

	useEffect(() => {
		if (!groupRef.current) {
			return;
		}

		const segments = groupRef.current.children as unknown as SVGPathElement[];

		Array.from(segments).forEach((child) => {
			const length = child.getTotalLength();
			child.style.strokeDasharray = length.toString();
			child.style.strokeDashoffset = length.toString();
		});

		animate(groupRef.current.children, {
			strokeDashoffset: 0,
			ease: "inOutSine",
			duration: 1500,
			delay: stagger(217),
			loop: false,
		});
	}, []);

	return (
		<svg
			viewBox="0 0 700 110"
			xmlns="http://www.w3.org/2000/svg"
			className={className}
			aria-hidden="true"
		>
			<defs>
				<filter id="g">
					<feDropShadow dx="-2" dy="-2" stdDeviation="0" floodColor="#662d53" />
					<feDropShadow stdDeviation="6" floodColor="#662d53" />
				</filter>
			</defs>

			<g className="headline-shadow">
				<path d="m0 0v110h29.0512647v-64.0234375h.854449l24.3517954 63.1640625h17.5162038l24.3517954-62.734375h.854449v63.59375h29.0512647v-110h-36.9549176l-25.4198567 62.3046875h-1.2816734l-25.4198567-62.3046875z" />
				<path d="m185.585265 110 6.301561-21.0546875h36.100469l6.301561 21.0546875h32.041836l-36.100468-110h-40.586326l-36.100469 110zm13.030347-43.3984375 10.894224-36.3085937h.854449l10.894225 36.3085937z" />
				<path d="m293.842665 110h29.692101v-36.3085938h10.253388l19.225101 36.3085938h32.255449l-22.215673-41.0351562c11.641867-5.6396485 18.584265-16.328125 18.584265-31.5820313 0-23.4179687-16.287934-37.3828125-40.586326-37.3828125h-47.208305zm29.692101-59.5117187v-26.640625h10.467c10.413597 0 16.661755 4.0820312 16.661755 13.5351562 0 9.3994141-6.248158 13.1054688-16.661755 13.1054688z" />
				<path d="m437.773049 0h-33.537121l36.100468 110h40.586326l36.100469-110h-33.537122l-22.429285 77.5585938h-.854449z" />
				<path d="m574.227265 0h-29.692102v110h29.692102z" />
				<path d="m700 0h-29.692101v57.578125h-.854449l-38.877428-57.578125h-25.206245v110h29.692102v-57.7929688h.640837l39.518264 57.7929688h24.77902z" />
			</g>

			<g ref={groupRef} className="headline-stroke">
				<path d="m0 0v110h29.0512647v-64.0234375h.854449l24.3517954 63.1640625h17.5162038l24.3517954-62.734375h.854449v63.59375h29.0512647v-110h-36.9549176l-25.4198567 62.3046875h-1.2816734l-25.4198567-62.3046875z" />
				<path d="m185.585265 110 6.301561-21.0546875h36.100469l6.301561 21.0546875h32.041836l-36.100468-110h-40.586326l-36.100469 110zm13.030347-43.3984375 10.894224-36.3085937h.854449l10.894225 36.3085937z" />
				<path d="m293.842665 110h29.692101v-36.3085938h10.253388l19.225101 36.3085938h32.255449l-22.215673-41.0351562c11.641867-5.6396485 18.584265-16.328125 18.584265-31.5820313 0-23.4179687-16.287934-37.3828125-40.586326-37.3828125h-47.208305zm29.692101-59.5117187v-26.640625h10.467c10.413597 0 16.661755 4.0820312 16.661755 13.5351562 0 9.3994141-6.248158 13.1054688-16.661755 13.1054688z" />
				<path d="m437.773049 0h-33.537121l36.100468 110h40.586326l36.100469-110h-33.537122l-22.429285 77.5585938h-.854449z" />
				<path d="m574.227265 0h-29.692102v110h29.692102z" />
				<path d="m700 0h-29.692101v57.578125h-.854449l-38.877428-57.578125h-25.206245v110h29.692102v-57.7929688h.640837l39.518264 57.7929688h24.77902z" />
			</g>
		</svg>
	);
}
